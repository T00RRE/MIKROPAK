# ==============================================================================
# | PODSTAWOWA KONFIGURACJA .HTACCESS                                          |
# ==============================================================================

<IfModule mod_rewrite.c>
    RewriteEngine On

    # ----------------------------------------------------------------------
    # | 1. PRZEKIEROWANIE NA HTTPS                                         |
    # ----------------------------------------------------------------------
    # Zapewnia, że cała strona działa w oparciu o bezpieczne połączenie SSL.
    RewriteCond %{HTTPS} !=on
    RewriteRule ^(.*)$ https://%{HTTP_HOST}%{REQUEST_URI} [L,R=301]

    # ----------------------------------------------------------------------
    # | 2. UJEDNOLICENIE ADRESU (WERSJA BEZ "WWW")                         |
    # ----------------------------------------------------------------------
    # Przekierowuje adres z www.twojadomena.pl na twojadomena.pl.
    # Jest to dobre dla SEO, ponieważ unika duplikacji treści.
    RewriteCond %{HTTP_HOST} ^www\.(.+)$ [NC]
    RewriteRule ^(.*)$ https://%1%{REQUEST_URI} [L,R=301]

    # ----------------------------------------------------------------------
    # | 3. PRZYJAZNE ADRESY URL (USUWANIE .HTML)                           |
    # ----------------------------------------------------------------------
    # Ta reguła pozwala na dostęp do `strona.html` poprzez adres `/strona`.
    
    # Najpierw przekierowuje użytkownika z adresu z .html na adres bez.
    RewriteCond %{THE_REQUEST} ^[A-Z]{3,9}\ /([^/]+)\.html\ HTTP/
    RewriteRule ^([^/]+)\.html$ /$1 [R=301,L]
    
    # Następnie wewnętrznie "mapuje" adres bez .html na właściwy plik.
    RewriteCond %{REQUEST_FILENAME} !-d
    RewriteCond %{REQUEST_FILENAME} !-f
    RewriteCond %{REQUEST_FILENAME}.html -f
    RewriteRule ^([^/]+)/?$ $1.html [L]

</IfModule>

# ==============================================================================
# | 4. PODSTAWOWE NAGŁÓWKI BEZPIECZEŃSTWA                                      |
# ==============================================================================
# Zwiększają odporność strony na popularne ataki webowe.
<IfModule mod_headers.c>
    # Ochrona przed clickjackingiem (uniemożliwia osadzenie strony w <frame> lub <iframe> na innych domenach).
    Header set X-Frame-Options "SAMEORIGIN"
    
    # Włącza wbudowaną w przeglądarki ochronę przed atakami XSS.
    Header set X-XSS-Protection "1; mode=block"
    
    # Zapobiega "MIME-sniffing", czyli próbie odgadnięcia typu zawartości przez przeglądarkę.
    Header set X-Content-Type-Options "nosniff"
    
    # Kontroluje, jakie informacje o stronie odsyłającej są wysyłane.
    Header set Referrer-Policy "no-referrer-when-downgrade"
</IfModule>

# ==============================================================================
# | 5. BUFOROWANIE W PRZEGLĄDARCE (BROWSER CACHING)                            |
# ==============================================================================
# Przyspiesza ładowanie strony dla powracających użytkowników,
# instruując przeglądarkę, aby przechowywała statyczne pliki przez określony czas.
<IfModule mod_expires.c>
    ExpiresActive On
    ExpiresByType image/jpg "access 1 year"
    ExpiresByType image/jpeg "access 1 year"
    ExpiresByType image/gif "access 1 year"
    ExpiresByType image/png "access 1 year"
    ExpiresByType image/svg+xml "access 1 year"
    ExpiresByType image/webp "access 1 year"
    ExpiresByType image/x-icon "access 1 year"
    
    ExpiresByType text/css "access 1 month"
    ExpiresByType text/javascript "access 1 month"
    ExpiresByType application/javascript "access 1 month"
    
    ExpiresByType application/x-font-ttf "access 1 year"
    ExpiresByType font/opentype "access 1 year"
    ExpiresByType application/font-woff "access 1 year"
    ExpiresByType application/font-woff2 "access 1 year"
    
    ExpiresDefault "access 2 days"
</IfModule>
